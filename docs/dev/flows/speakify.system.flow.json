{
  "file": "speakify/docs/dev/flows/speakify.system.flow.json",
  "description": "Flow documentation for core API endpoints in Speakify",

  "validate_session": {
    "description": "Validates a user session via token",
    "entry": "/public/api/index.php?action=validate_session",
    "flow": [
      {
        "file": "public/api/index.php",
        "action": "Reads `action` from $_GET, routes to validate_session"
      },
      {
        "file": "backend/actions/validate_session.php",
        "action": "Requires init.php and calls SessionManager::validateToken"
      },
      {
        "file": "backend/init.php",
        "action": "Loads config.php, sets up PDO connection"
      },
      {
        "file": "backend/config.php",
        "action": "Parses config.json and defines constants"
      },
      {
        "file": "backend/classes/SessionManager.php",
        "action": "validateToken(token) → Prepares SQL, fetches session, returns result"
      },
      {
        "db": "sessions table",
        "query": "SELECT * FROM sessions WHERE token = ?"
      }
    ]
  },

  "register_user": {
    "description": "Registers a new user with email, password, and full name",
    "entry": "/public/api/index.php?action=register",
    "flow": [
      {
        "file": "public/api/index.php",
        "action": "Reads `action` from $_GET, routes to register"
      },
      {
        "file": "backend/actions/register.php",
        "action": "Requires init.php and calls SessionManager::registerUser"
      },
      {
        "file": "backend/init.php",
        "action": "Initializes database and constants"
      },
      {
        "file": "backend/classes/SessionManager.php",
        "action": "registerUser(email, password, name) → Validates input, hashes password, inserts new user"
      },
      {
        "file": "backend/utils/hash.php",
        "action": "Uses password_hash to securely hash user password"
      },
      {
        "db": "users table",
        "query": "INSERT INTO users (email, password, name) VALUES (?, ?, ?)"
      }
    ]
  }
}
